<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
    <?php require_once 'nav.html'; ?>

    <h1>Movies Database</h1>
<!-- Form forselecting -->
<form action="" method="POST">
    <!-- sort by title -->
    <select class="filterClass" name="sortSelection" id="sortSelection">
        <option value="ASC">Sort by ascending</option>
        <option value="DESC">Sort by descending</option>
    </select>
       <!-- sort by director -->
    <select class="filterClass" name="category" id="category">
        <option value="all">All categories</option>
    </select>

</form>
<div id="moviesContainer"></div>

    <script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous">
    </script>
<script>
$(function () {
/* Default all movies on the list */
$.ajax({
                    url: 'moviecatalog.php',
                    method: 'post',
                    data: {sortSelection:'ASC', directors:'all'},
                    dataType: 'json'

                }).done(function(result) {
                    // If ajax call worked
                    $('#moviesContainer').html('');
                    let movies = result;
                    console.log(movies);
                    $.each(movies, function(key, movie) {
                        $('#moviesContainer').append('<h3>Movie title: ' + movie.title + '</h3>');
                        $('#moviesContainer').append('<h4>Director name: ' + movie.director + '</h4>');
                        $('#moviesContainer').append('<h4>Views: ' + movie.views + '</h4>');
                        $('#moviesContainer').append('<img src="../images/' + movie.poster + '" alt="">');
                        $('#moviesContainer').append('<hr>'); 
                    });
                }).fail(function (result) {
                    // If AJAX failed
                    console.log('AJAX ERROR: movies '+ result);
                });
/* ----------------------------------- */
$.ajax({
                    url: 'getMovies.php',
                    method: 'post',
                    data: { directors:$(this).val()},
                    dataType: 'json',
					
                }).done(function(result) {
                    // If ajax call worked
                    $.each(result, function( index, director ) {
                    $("#directors").append("<option value='"+director.id+"'>"+director.name+"</option>");
                    });           
                    console.log('SUCCESS : ' + result);
                }).fail(function (result) {
                    // If AJAX failed
                    console.log('AJAX ERROR: directors');
                });
/* ------SELECT Filter ASC or DSC------------------------ */
    $('.filterClass').change(function (e) {
            /* $('#allMoviesBtn').click(function (e) { */
                $.ajax({
                    url: 'my_getMovie.php',
                    method: 'post',
                    data: {sortSelection:$('#sortSelection').val(), directors: $('#directors').val()},
                    dataType: 'json'

                }).done(function(result) {
                    // If ajax call worked
                    $('#moviesContainer').html('');
                    let movies = result;
                    console.log(movies);
                    $.each(movies, function(key, movie) {
                        $('#moviesContainer').append('<h3>Movie title: ' + movie.title + '</h3>');
                        $('#moviesContainer').append('<h4>Director name: ' + movie.director + '</h4>');
                        $('#moviesContainer').append('<p>Views: ' + movie.views + '</p>');
                        $('#moviesContainer').append('<img src="../images/' + movie.poster + '" alt="">');
                        $('#moviesContainer').append('<hr>');       
                    });
                }).fail(function (result) {
                    // If AJAX failed
                    console.log('AJAX ERROR: movies');
                });
            });

});
</script>
</body>
</html>