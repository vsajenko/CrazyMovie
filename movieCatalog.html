<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<header>
    <ul>
        <li>
            <h3>CrayMovie</h3>
        </li>
        <li>Username</li>
        <li><a href="">Play list</a></li>
        <li><a href="">logout</a></li>
    </ul>
    <ul>
        <li><a href="./">Home</a></li>
        <li><a href="">Edit movie</a></li>
        <li></li>
    </ul>
</header>
<body>
    <h1>Movie database</h1>
    <form action="" method="POST">
        <!-- Search input -->
        <label for="searchMovie">Search bar: </label>
        <input type="text" name="searchMovie" id="searchMovie" placeholder="Search the movie">
        <br>
        <!-- sort by categories -->
        <label for="filterCategory">Sorting by: </label>
        <select name="filterCategory" id="filterCategory">
            <option value="all">All category</option>
        </select>
        <!-- sort by from up to down or from down to top-->
        <select name="filterSelection" id="filterSelection">
            <option value="ASC">Ascending</option>
            <option value="DESC">Descending</option>
        </select>
    </form>
    <hr>
    <!-- All info from database will shown here in moviesContainer -->
    <div id="moviesContainer">

    </div>
    
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"
        integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous">
        </script>
    <script>
        $(function(){
            /* default all movies */
            $.ajax({
                    url:'moviecatalog.php',
                    method:'post',
                    data:{filterSelection:'ASC', 
                        filterCategory:'all',
                        searchMovie: ''
                        },
                    dataType:'json'

            }).done(function(result){

                //$('#moviesContainer').html('');
                let movies=result;
                console.log(movies);
                $.each(movies, function(key, movie){
                    $('#moviesContainer').append('<h3> #' + movie.id +' Title: '+ movie.title+'</h3>');
                    $('#moviesContainer').append('<img src="images/movies/'+ movie.poster+'" alt="">');
                    $('#moviesContainer').append('<hr>'); 
                });
            }).fail(function(result){
                // If AJAX failed
                console.log('AJAX ERROR: movies ' + result);
            });
/* ------------------------------ */
            $.ajax({
                    url:'category.php',
                    /* method:'post',
                    data: {filterSelection:'ASC',
                        filterCategory:'all'
                        }, */
                    dataType:'json'
                }).done(function(result){
                        $.each(result,function(key,categ){
                            $('#filterCategory').append('<option value="'+ categ.category_id+'">'+ categ.category+'</option>')
                        });
                }).fail(function(result){
                    console.log('AJAX ERROR: categories ' + result);
                });   
/*---------sorting functions ASC or DSC------------------------- */
$('#filterSelection').change(function(){
            $.ajax({
                    url:'moviecatalog.php',
                    method:'post',
                    data:{ filterSelection:$('#filterSelection').val(),
                        filterCategory:$('#filterCategory').val(),
                        searchMovie: $('#searchMovie').val()
                        },
                    dataType:'json'
                }).done(function(result){
                    $('#moviesContainer').html('')
                    $.each(result, function (key, movie) {
                        $('#moviesContainer').append('<h3> #' + movie.id + ' Title: ' + movie.title + '</h3>');
                        $('#moviesContainer').append('<img src="images/movies/' + movie.poster + '" alt="">');
                        $('#moviesContainer').append('<hr>'); 
                        });
                }).fail(function (result) {
                    console.log('AJAX ERROR: sorting movies ' + result);
                    });
            });
/* -----------sorting function by categoryes-------------------------------- */
            $('#filterCategory').change(function(){
                $.ajax({
                    url:'moviecatalog.php',
                    method:'post',
                    data: { filterSelection:$('#filterSelection').val(), 
                            filterCategory: $(this).val(),
                            searchMovie:$('#searchMovie').val()
                            },
                    dataType:'json'
                }).done(function(result){
                        $('#moviesContainer').html('');
                    
                    $.each(result, function (key, movie) {
                        //$('#moviesContainer').append('<div style="display: flex;"><img src="images/movies/' + movie.poster + '" alt=""><div><h3 h3 > #' + movie.id + ' Title: ' + movie.title + '</h3><p>Views: ' + movie.views + '</p></div></div>');
                            $('#moviesContainer').append(' <h3> #' + movie.id + ' Title: ' + movie.title + '</h3>');
                            $('#moviesContainer').append('<img src="images/movies/' + movie.poster + '" alt="">');
                            $('#moviesContainer').append('<hr>'); 
                        });
                }).fail(function(result){
                    console.log('AJAX ERROR: categories-movies'); 
                });
            });
/* ------------Searching in the database--------------------------------- */
            $('#searchMovie').keyup(function(){
                $.ajax({
                    url: 'moviecatalog.php',
                    method:'post',
                    data:{ searchMovie:$(this).val(),
                        filterSelection: 'ASC',
                        filterCategory: 'all'
                    },
                    dataType:'json'
                    
                }).done(function(result){
                   
                    $('#moviesContainer').html('');
                    $.each(result,function (key, movie) {
                        console.log(movie.id);
                        console.log(movie.title);


                        $('#moviesContainer').append('<h3> #' + movie.id + ' Title: ' + movie.title + '</h3>');
                        $('#moviesContainer').append('<img src="images/movies/' + movie.poster + '" alt="">');
                        $('#moviesContainer').append('<hr>');
                    });
                }).fail(function(result){
                    console.log('AJAX ERROR: searching-movies'); 
                });

            });
/* --------------------------------------------- */


        });
</script>






</body>
</html>